<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Jedi Space Adventure Academy</title>
    <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700;900&display=swap" rel="stylesheet">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Orbitron', sans-serif;
            background: radial-gradient(circle at center, #0a0a2e 0%, #000000 100%);
            min-height: 100vh;
            overflow: hidden;
            position: relative;
            cursor: default;
        }

        /* Star field background */
        .stars {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: 1;
        }

        .star {
            position: absolute;
            background: white;
            border-radius: 50%;
            animation: twinkle 3s ease-in-out infinite alternate;
        }

        @keyframes twinkle {
            0% { opacity: 0.3; transform: scale(1); }
            100% { opacity: 1; transform: scale(1.2); }
        }

        /* Main game container */
        .game-container {
            position: relative;
            z-index: 10;
            height: 100vh;
            display: flex;
            flex-direction: column;
        }

        /* Header with navigation and progress */
        .game-header {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            z-index: 1000;
            background: linear-gradient(135deg, rgba(0,0,0,0.9), rgba(10,10,46,0.8));
            border-bottom: 2px solid #ffe81f;
            padding: 15px 30px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .nav-button {
            background: linear-gradient(45deg, #ffe81f, #ffd700);
            color: #000;
            border: 2px solid #ffe81f;
            padding: 10px 20px;
            border-radius: 25px;
            font-family: 'Orbitron', sans-serif;
            font-size: 0.9rem;
            font-weight: bold;
            cursor: pointer;
            text-decoration: none;
            display: flex;
            align-items: center;
            gap: 8px;
            box-shadow: 0 0 15px rgba(255, 232, 31, 0.5);
            transition: all 0.3s ease;
        }

        .nav-button:hover {
            transform: scale(1.05);
            box-shadow: 0 0 25px rgba(255, 232, 31, 0.8);
        }

        .jedi-rank {
            color: #4fc3f7;
            font-size: 1.2rem;
            font-weight: bold;
            text-shadow: 0 0 10px #4fc3f7;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .game-controls {
            display: flex;
            gap: 15px;
        }

        .control-button {
            background: linear-gradient(45deg, #4fc3f7, #2563eb);
            color: #fff;
            border: 2px solid #4fc3f7;
            padding: 8px 15px;
            border-radius: 20px;
            font-family: 'Orbitron', sans-serif;
            font-size: 0.9rem;
            font-weight: bold;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 5px;
            box-shadow: 0 0 10px rgba(79, 195, 247, 0.4);
            transition: all 0.3s ease;
        }

        .control-button:hover {
            transform: scale(1.05);
            box-shadow: 0 0 20px rgba(79, 195, 247, 0.8);
        }

        /* Main content area */
        .main-content {
            flex: 1;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 100px 20px 20px;
        }

        /* Mission Selection Screen */
        .mission-select {
            text-align: center;
            max-width: 1000px;
            width: 100%;
        }

        .mission-title {
            font-size: 3rem;
            font-weight: 900;
            color: #ffe81f;
            text-shadow: 0 0 20px #ffe81f, 0 0 40px #fff200;
            margin-bottom: 2rem;
            animation: float 3s ease-in-out infinite;
        }

        .mission-subtitle {
            font-size: 1.4rem;
            color: #4fc3f7;
            text-shadow: 0 0 10px #4fc3f7;
            margin-bottom: 3rem;
            animation: glow 2s ease-in-out infinite alternate;
        }

        .planets-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 30px;
            margin-bottom: 2rem;
        }

        .planet-card {
            background: linear-gradient(135deg, rgba(0,0,0,0.8), rgba(10,10,46,0.9));
            border: 3px solid #4fc3f7;
            border-radius: 20px;
            padding: 30px;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 0 20px rgba(79, 195, 247, 0.3);
            animation: planetFloat 4s ease-in-out infinite;
        }

        .planet-card:hover {
            transform: scale(1.05) translateY(-10px);
            border-color: #ffe81f;
            box-shadow: 0 0 30px rgba(255, 232, 31, 0.6);
        }

        .planet-card.math { border-color: #4fc3f7; }
        .planet-card.words { border-color: #4ade80; }
        .planet-card.logic { border-color: #a855f7; }

        .planet-icon {
            font-size: 4rem;
            margin-bottom: 15px;
            display: block;
            animation: planetSpin 8s linear infinite;
        }

        .planet-name {
            font-size: 1.5rem;
            font-weight: bold;
            color: #ffe81f;
            margin-bottom: 10px;
            text-shadow: 0 0 10px #ffe81f;
        }

        .planet-description {
            color: #ccc;
            font-size: 1rem;
            line-height: 1.4;
            margin-bottom: 15px;
        }

        .planet-progress {
            background: rgba(255,255,255,0.2);
            height: 8px;
            border-radius: 4px;
            overflow: hidden;
            margin-bottom: 10px;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #4fc3f7, #ffe81f);
            border-radius: 4px;
            transition: width 0.5s ease;
        }

        .planet-status {
            font-size: 0.9rem;
            color: #4fc3f7;
            font-weight: bold;
        }

        /* Mission Screen */
        .mission-screen {
            display: none;
            width: 100%;
            max-width: 800px;
            text-align: center;
        }

        .mission-header {
            margin-bottom: 30px;
        }

        .mission-planet-name {
            font-size: 2.5rem;
            font-weight: bold;
            color: #ffe81f;
            text-shadow: 0 0 20px #ffe81f;
            margin-bottom: 10px;
        }

        .mission-story {
            font-size: 1.2rem;
            color: #4fc3f7;
            line-height: 1.6;
            margin-bottom: 30px;
            padding: 20px;
            background: rgba(0,0,0,0.6);
            border-radius: 15px;
            border: 2px solid #4fc3f7;
        }

        .challenge-container {
            background: linear-gradient(135deg, rgba(0,0,0,0.8), rgba(10,10,46,0.9));
            border: 3px solid #ffe81f;
            border-radius: 20px;
            padding: 40px;
            margin-bottom: 20px;
        }

        .challenge-question {
            font-size: 2rem;
            color: #fff;
            margin-bottom: 30px;
            text-shadow: 0 0 10px #fff;
        }

        .challenge-options {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 15px;
            margin-bottom: 30px;
        }

        .option-button {
            background: linear-gradient(45deg, #4fc3f7, #2563eb);
            color: #fff;
            border: 2px solid #4fc3f7;
            padding: 15px 20px;
            border-radius: 15px;
            font-family: 'Orbitron', sans-serif;
            font-size: 1.2rem;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 0 15px rgba(79, 195, 247, 0.4);
        }

        .option-button:hover {
            transform: scale(1.05);
            box-shadow: 0 0 25px rgba(79, 195, 247, 0.8);
        }

        .option-button.correct {
            background: linear-gradient(45deg, #4ade80, #22c55e);
            border-color: #4ade80;
            animation: correctPulse 0.6s ease-in-out;
        }

        .option-button.incorrect {
            background: linear-gradient(45deg, #ff4444, #dc2626);
            border-color: #ff4444;
            animation: incorrectShake 0.6s ease-in-out;
        }

        .mission-controls {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-top: 20px;
        }

        .back-button {
            background: linear-gradient(45deg, #6b7280, #4b5563);
            color: #fff;
            border: 2px solid #6b7280;
            padding: 12px 20px;
            border-radius: 15px;
            font-family: 'Orbitron', sans-serif;
            font-size: 1rem;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .back-button:hover {
            background: linear-gradient(45deg, #4b5563, #6b7280);
            transform: scale(1.05);
        }

        .mission-progress {
            color: #ffe81f;
            font-size: 1.2rem;
            font-weight: bold;
            text-shadow: 0 0 10px #ffe81f;
        }

        /* Animations */
        @keyframes float {
            0%, 100% { transform: translateY(0px); }
            50% { transform: translateY(-10px); }
        }

        @keyframes glow {
            0% { text-shadow: 0 0 10px #4fc3f7; }
            100% { text-shadow: 0 0 20px #4fc3f7, 0 0 30px #4fc3f7; }
        }

        @keyframes planetFloat {
            0%, 100% { transform: translateY(0px); }
            50% { transform: translateY(-5px); }
        }

        @keyframes planetSpin {
            from { transform: rotate(0deg); }
            to { transform: rotate(360deg); }
        }

        @keyframes correctPulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.1); }
            100% { transform: scale(1); }
        }

        @keyframes incorrectShake {
            0%, 100% { transform: translateX(0); }
            25% { transform: translateX(-5px); }
            75% { transform: translateX(5px); }
        }

        /* Achievement popup */
        .achievement {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: linear-gradient(135deg, rgba(0,0,0,0.95), rgba(10,10,46,0.95));
            color: #4ade80;
            font-size: 2rem;
            font-weight: bold;
            text-shadow: 0 0 20px #4ade80;
            z-index: 2000;
            opacity: 0;
            pointer-events: none;
            padding: 30px 50px;
            border-radius: 20px;
            border: 3px solid #4ade80;
            text-align: center;
            animation: achievementPop 3s ease-out forwards;
        }

        @keyframes achievementPop {
            0% { opacity: 0; transform: translate(-50%, -50%) scale(0.5); }
            20% { opacity: 1; transform: translate(-50%, -50%) scale(1.1); }
            80% { opacity: 1; transform: translate(-50%, -50%) scale(1); }
            100% { opacity: 0; transform: translate(-50%, -50%) scale(1); }
        }

        /* Story cutscene */
        .story-cutscene {
            position: fixed;
            top: 0;
            left: 0;
            width: 100vw;
            height: 100vh;
            background: rgba(0, 0, 0, 0.95);
            display: none;
            align-items: center;
            justify-content: center;
            z-index: 3000;
        }

        .cutscene-content {
            max-width: 600px;
            text-align: center;
            color: #ffe81f;
            padding: 40px;
        }

        .cutscene-title {
            font-size: 2.5rem;
            font-weight: bold;
            margin-bottom: 20px;
            text-shadow: 0 0 20px #ffe81f;
        }

        .cutscene-text {
            font-size: 1.3rem;
            line-height: 1.6;
            margin-bottom: 30px;
            color: #4fc3f7;
        }

        .cutscene-button {
            background: linear-gradient(45deg, #ffe81f, #ffd700);
            color: #000;
            border: 2px solid #ffe81f;
            padding: 15px 30px;
            border-radius: 25px;
            font-family: 'Orbitron', sans-serif;
            font-size: 1.1rem;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 0 20px rgba(255, 232, 31, 0.5);
        }

        .cutscene-button:hover {
            transform: scale(1.05);
            box-shadow: 0 0 30px rgba(255, 232, 31, 0.8);
        }

        /* Responsive design */
        @media (max-width: 768px) {
            .mission-title { font-size: 2rem; }
            .planets-grid { grid-template-columns: 1fr; }
            .planet-card { padding: 20px; }
            .game-header { padding: 10px 20px; }
            .challenge-question { font-size: 1.5rem; }
        }
    </style>
</head>
<body>
    <!-- Stars background -->
    <div class="stars" id="stars"></div>

    <!-- Game container -->
    <div class="game-container">
        <!-- Header -->
        <div class="game-header">
            <a href="index.html" class="nav-button">
                <span>‚≠ê</span>
                <span>Classic Star Wars</span>
            </a>
            
            <div class="jedi-rank">
                <span id="rankIcon">üéì</span>
                <span id="rankText">Jedi Padawan</span>
            </div>
            
            <div class="game-controls">
                <button class="control-button" id="audioBtn" onclick="toggleAudio()">
                    <span id="audioIcon">üîä</span>
                    <span id="audioText">Audio</span>
                </button>
            </div>
        </div>

        <!-- Main content -->
        <div class="main-content">
            <!-- Mission Selection Screen -->
            <div class="mission-select" id="missionSelect">
                <h1 class="mission-title">üöÄ Jedi Space Academy üöÄ</h1>
                <p class="mission-subtitle">Choose your adventure, young Jedi! Each planet has unique challenges to master.</p>
                
                <div class="planets-grid">
                    <!-- Math Planet -->
                    <div class="planet-card math" onclick="selectPlanet('math')">
                        <span class="planet-icon">ü™ê</span>
                        <div class="planet-name">Calculon Prime</div>
                        <div class="planet-description">
                            Help R2-D2 repair the Death Star's computers! Solve math problems to restore power to the galaxy.
                        </div>
                        <div class="planet-progress">
                            <div class="progress-fill" id="mathProgress" style="width: 0%"></div>
                        </div>
                        <div class="planet-status" id="mathStatus">Ready for Adventure!</div>
                    </div>

                    <!-- Words Planet -->
                    <div class="planet-card words" onclick="selectPlanet('words')">
                        <span class="planet-icon">üåç</span>
                        <div class="planet-name">Vocabularis</div>
                        <div class="planet-description">
                            Decode secret Rebel messages! Learn powerful words to communicate with the Resistance.
                        </div>
                        <div class="planet-progress">
                            <div class="progress-fill" id="wordsProgress" style="width: 0%"></div>
                        </div>
                        <div class="planet-status" id="wordsStatus">Ready for Adventure!</div>
                    </div>

                    <!-- Logic Planet -->
                    <div class="planet-card logic" onclick="selectPlanet('logic')">
                        <span class="planet-icon">üîÆ</span>
                        <div class="planet-name">Pattern Nexus</div>
                        <div class="planet-description">
                            Unlock ancient Jedi wisdom! Solve these sequences to unlock hidden Force powers and wisdom.
                        </div>
                        <div class="planet-progress">
                            <div class="progress-fill" id="logicProgress" style="width: 0%"></div>
                        </div>
                        <div class="planet-status" id="logicStatus">Ready for Adventure!</div>
                    </div>
                </div>
            </div>

            <!-- Mission Screen -->
            <div class="mission-screen" id="missionScreen">
                <div class="mission-header">
                    <h2 class="mission-planet-name" id="currentPlanetName">Planet Name</h2>
                    <div class="mission-story" id="missionStory">Mission story will appear here...</div>
                </div>

                <div class="challenge-container">
                    <div class="challenge-question" id="challengeQuestion">Question will appear here</div>
                    <div class="challenge-options" id="challengeOptions">
                        <!-- Options will be generated here -->
                    </div>
                </div>

                <div class="mission-controls">
                    <button class="back-button" onclick="returnToMissionSelect()">
                        ‚Üê Back to Space Map
                    </button>
                    <div class="mission-progress" id="missionProgressText">
                        Mission 1 of 5
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Story Cutscene -->
    <div class="story-cutscene" id="storyCutscene">
        <div class="cutscene-content">
            <h2 class="cutscene-title" id="cutsceneTitle">Achievement Unlocked!</h2>
            <p class="cutscene-text" id="cutsceneText">Story text will appear here...</p>
            <button class="cutscene-button" onclick="closeCutscene()">Continue Adventure</button>
        </div>
    </div>

    <script>
        // Game state
        let gameState = {
            currentPlanet: null,
            currentMission: 0,
            planetProgress: {
                math: 0,
                words: 0,
                logic: 0
            },
            jediRank: 0,
            audioEnabled: false,
            audioContext: null
        };

        // Mission data
        const planetData = {
            math: {
                name: "Calculon Prime",
                icon: "ü™ê",
                story: "R2-D2 needs your help! The Death Star's computers are malfunctioning. Use your math skills to restore power and save the galaxy!",
                missions: [
                    {
                        story: "R2-D2 beeps frantically! The hyperdrive calculations are wrong!",
                        question: "What is 3 + 4?",
                        options: ["6", "7", "8", "9"],
                        correct: 1,
                        celebration: "üöÄ Excellent! The hyperdrive is working again!"
                    },
                    {
                        story: "The Death Star's shield generator needs power calculations!",
                        question: "What is 5 √ó 2?",
                        options: ["8", "10", "12", "15"],
                        correct: 1,
                        celebration: "‚ö° Amazing! The shields are back online!"
                    },
                    {
                        story: "Obi-Wan needs help calculating the number of escape pods!",
                        question: "What is 12 √∑ 3?",
                        options: ["3", "4", "5", "6"],
                        correct: 1,
                        celebration: "üõ∏ Perfect! Everyone can escape safely!"
                    },
                    {
                        story: "Luke needs to calculate his X-wing's fuel consumption!",
                        question: "What is 8 - 3?",
                        options: ["4", "5", "6", "7"],
                        correct: 1,
                        celebration: "‚úàÔ∏è Great job! Luke has enough fuel for the mission!"
                    },
                    {
                        story: "The Millennium Falcon needs navigation coordinates!",
                        question: "What is 6 + 7?",
                        options: ["12", "13", "14", "15"],
                        correct: 1,
                        celebration: "üåü Incredible! Han Solo found the secret base!"
                    }
                ]
            },
            words: {
                name: "Vocabularis",
                icon: "üåç",
                story: "The Rebel Alliance needs you to decode secret messages! Learn powerful words to help the Resistance communicate safely.",
                missions: [
                    {
                        story: "Princess Leia sent a coded message! What does this word mean?",
                        question: "What does 'BRAVE' mean?",
                        options: ["Scared", "Courageous", "Tired", "Hungry"],
                        correct: 1,
                        celebration: "üëë Excellent! Leia's message is decoded!"
                    },
                    {
                        story: "Yoda left a wisdom scroll! Can you understand it?",
                        question: "What does 'WISDOM' mean?",
                        options: ["Knowledge", "Food", "Sleep", "Fast"],
                        correct: 0,
                        celebration: "üßô‚Äç‚ôÇÔ∏è Wonderful! You understand Yoda's teaching!"
                    },
                    {
                        story: "The Jedi Council needs you to understand this important word!",
                        question: "What does 'PEACE' mean?",
                        options: ["War", "Calm & Harmony", "Noise", "Running"],
                        correct: 1,
                        celebration: "‚òÆÔ∏è Perfect! The galaxy is closer to peace!"
                    },
                    {
                        story: "C-3PO is translating an ancient text! Help him understand!",
                        question: "What does 'FORCE' mean in Star Wars?",
                        options: ["Push hard", "Magic power", "Energy field", "Spaceship"],
                        correct: 2,
                        celebration: "üåå Amazing! C-3PO's translation is complete!"
                    },
                    {
                        story: "Chewbacca found an old Wookiee saying! What does it mean?",
                        question: "What does 'FRIENDSHIP' mean?",
                        options: ["Being alone", "Caring bond", "Fighting", "Eating"],
                        correct: 1,
                        celebration: "üêª Roooaaaar! Chewie is so happy!"
                    }
                ]
            },
            logic: {
                name: "Pattern Nexus",
                icon: "üîÆ",
                story: "Ancient Jedi temples hold mystical patterns! Solve these sequences to unlock hidden Force powers and wisdom.",
                missions: [
                    {
                        story: "Master Yoda's meditation chamber has a glowing pattern!",
                        question: "What comes next? 2, 4, 6, ?",
                        options: ["7", "8", "9", "10"],
                        correct: 1,
                        celebration: "üßò‚Äç‚ôÇÔ∏è Excellent! Yoda's meditation power is unlocked!"
                    },
                    {
                        story: "The Jedi Temple's ancient door shows a sequence!",
                        question: "What comes next? 1, 3, 5, ?",
                        options: ["6", "7", "8", "9"],
                        correct: 1,
                        celebration: "üèõÔ∏è Amazing! The temple door opens!"
                    },
                    {
                        story: "Obi-Wan's lightsaber crystal resonates with this pattern!",
                        question: "What comes next? 5, 10, 15, ?",
                        options: ["18", "20", "22", "25"],
                        correct: 1,
                        celebration: "‚öîÔ∏è Perfect! The lightsaber glows brighter!"
                    },
                    {
                        story: "The Force flows through this mysterious sequence!",
                        question: "What comes next? 1, 4, 7, ?",
                        options: ["9", "10", "11", "12"],
                        correct: 1,
                        celebration: "üåü Incredible! You can feel the Force!"
                    },
                    {
                        story: "The Death Star plans reveal a secret pattern!",
                        question: "What comes next? 3, 6, 9, ?",
                        options: ["11", "12", "13", "15"],
                        correct: 1,
                        celebration: "üí´ Outstanding! The Death Star's weakness is revealed!"
                    }
                ]
            }
        };

        const jediRanks = [
            { rank: "Jedi Youngling", icon: "üéì", required: 0 },
            { rank: "Jedi Padawan", icon: "‚öîÔ∏è", required: 5 },
            { rank: "Jedi Knight", icon: "üõ°Ô∏è", required: 10 },
            { rank: "Jedi Master", icon: "üåü", required: 15 },
            { rank: "Jedi Grand Master", icon: "üëë", required: 20 }
        ];

        // Initialize game
        function initGame() {
            createStars();
            updateJediRank();
            updatePlanetProgress();
            
            // Show welcome message
            setTimeout(() => {
                showStory("üåü Welcome, Young Jedi!", "Your journey begins now! Choose a planet to start your adventure and help save the galaxy. May the Force be with you!");
            }, 1000);
        }

        // Create animated stars
        function createStars() {
            const starsContainer = document.getElementById('stars');
            const numStars = 100;
            
            for (let i = 0; i < numStars; i++) {
                const star = document.createElement('div');
                star.className = 'star';
                star.style.left = Math.random() * 100 + '%';
                star.style.top = Math.random() * 100 + '%';
                star.style.width = star.style.height = Math.random() * 3 + 1 + 'px';
                star.style.animationDelay = Math.random() * 3 + 's';
                starsContainer.appendChild(star);
            }
        }

        // Planet selection
        function selectPlanet(planetType) {
            gameState.currentPlanet = planetType;
            gameState.currentMission = 0;
            
            const planet = planetData[planetType];
            showStory(`üöÄ Destination: ${planet.name}`, planet.story, () => {
                showMissionScreen();
            });
        }

        // Show mission screen
        function showMissionScreen() {
            document.getElementById('missionSelect').style.display = 'none';
            document.getElementById('missionScreen').style.display = 'block';
            
            loadCurrentMission();
        }

        // Load current mission
        function loadCurrentMission() {
            const planet = planetData[gameState.currentPlanet];
            const mission = planet.missions[gameState.currentMission];
            
            console.log(`Loading mission ${gameState.currentMission + 1} for ${planet.name}`);
            
            document.getElementById('currentPlanetName').textContent = planet.name;
            document.getElementById('missionStory').textContent = mission.story;
            document.getElementById('challengeQuestion').textContent = mission.question;
            document.getElementById('missionProgressText').textContent = 
                `Mission ${gameState.currentMission + 1} of ${planet.missions.length}`;
            
            // Create option buttons
            const optionsContainer = document.getElementById('challengeOptions');
            optionsContainer.innerHTML = '';
            
            mission.options.forEach((option, index) => {
                const button = document.createElement('button');
                button.className = 'option-button';
                button.textContent = option;
                button.style.pointerEvents = 'auto'; // Ensure buttons are clickable
                button.onclick = () => selectAnswer(index);
                optionsContainer.appendChild(button);
            });
            
            console.log(`Created ${mission.options.length} buttons for mission`);
        }

        // Handle answer selection
        function selectAnswer(selectedIndex) {
            const planet = planetData[gameState.currentPlanet];
            const mission = planet.missions[gameState.currentMission];
            const buttons = document.querySelectorAll('.option-button');
            
            console.log(`Answer selected: ${selectedIndex}, Correct answer: ${mission.correct}`);
            
            // Disable all buttons to prevent multiple clicks
            buttons.forEach(button => button.style.pointerEvents = 'none');
            
            if (selectedIndex === mission.correct) {
                // Correct answer
                buttons[selectedIndex].classList.add('correct');
                playSuccessSound();
                
                console.log(`Correct! Advancing from mission ${gameState.currentMission} to ${gameState.currentMission + 1}`);
                
                setTimeout(() => {
                    gameState.planetProgress[gameState.currentPlanet]++;
                    updatePlanetProgress();
                    updateJediRank();
                    
                    showAchievement(mission.celebration);
                    
                    setTimeout(() => {
                        gameState.currentMission++;
                        console.log(`New mission index: ${gameState.currentMission}, Total missions: ${planet.missions.length}`);
                        
                        if (gameState.currentMission >= planet.missions.length) {
                            // Planet completed!
                            console.log("Planet completed!");
                            completePlanet();
                        } else {
                            // Next mission
                            console.log("Loading next mission...");
                            loadCurrentMission();
                        }
                    }, 2500); // Increased delay to see achievement better
                }, 1000);
            } else {
                // Incorrect answer
                buttons[selectedIndex].classList.add('incorrect');
                buttons[mission.correct].classList.add('correct');
                playErrorSound();
                
                console.log("Incorrect answer, retrying same mission");
                
                setTimeout(() => {
                    showAchievement("üí™ Good try! Learn from mistakes, young Jedi!");
                    setTimeout(() => {
                        // Try again - don't advance mission
                        console.log("Reloading current mission for retry");
                        loadCurrentMission();
                    }, 2500);
                }, 1000);
            }
        }

        // Complete planet
        function completePlanet() {
            const planet = planetData[gameState.currentPlanet];
            const totalCompleted = Object.values(gameState.planetProgress).reduce((a, b) => a + b, 0);
            
            let completionMessage = `üéâ ${planet.name} Completed! üéâ\n\n`;
            
            if (totalCompleted >= 15) {
                completionMessage += "üèÜ INCREDIBLE! You've mastered all three planets! You are now a true Jedi Master! The galaxy is safe thanks to you!";
            } else if (totalCompleted >= 10) {
                completionMessage += "‚öîÔ∏è Amazing progress! You're becoming a powerful Jedi! Try the other planets to continue your journey!";
            } else {
                completionMessage += "üåü Excellent work! You've helped save this part of the galaxy! Ready for your next adventure?";
            }
            
            showStory("Mission Complete!", completionMessage, () => {
                returnToMissionSelect();
            });
        }

        // Return to mission select
        function returnToMissionSelect() {
            document.getElementById('missionScreen').style.display = 'none';
            document.getElementById('missionSelect').style.display = 'block';
            gameState.currentPlanet = null;
            gameState.currentMission = 0; // Reset mission counter
            console.log("Returned to mission select, reset mission counter");
        }

        // Update planet progress
        function updatePlanetProgress() {
            Object.keys(gameState.planetProgress).forEach(planet => {
                const progress = gameState.planetProgress[planet];
                const maxMissions = planetData[planet].missions.length;
                const percentage = (progress / maxMissions) * 100;
                
                document.getElementById(`${planet}Progress`).style.width = percentage + '%';
                
                let status;
                if (progress === maxMissions) {
                    status = "üèÜ Planet Mastered!";
                } else if (progress > 0) {
                    status = `${progress}/${maxMissions} missions complete`;
                } else {
                    status = "Ready for Adventure!";
                }
                document.getElementById(`${planet}Status`).textContent = status;
            });
        }

        // Update Jedi rank
        function updateJediRank() {
            const totalProgress = Object.values(gameState.planetProgress).reduce((a, b) => a + b, 0);
            
            for (let i = jediRanks.length - 1; i >= 0; i--) {
                if (totalProgress >= jediRanks[i].required) {
                    if (gameState.jediRank !== i) {
                        gameState.jediRank = i;
                        const rank = jediRanks[i];
                        document.getElementById('rankIcon').textContent = rank.icon;
                        document.getElementById('rankText').textContent = rank.rank;
                        
                        if (i > 0) {
                            showAchievement(`üéñÔ∏è Rank Up! You are now a ${rank.rank}!`);
                        }
                    }
                    break;
                }
            }
        }

        // Show story cutscene
        function showStory(title, text, callback = null) {
            document.getElementById('cutsceneTitle').textContent = title;
            document.getElementById('cutsceneText').textContent = text;
            document.getElementById('storyCutscene').style.display = 'flex';
            
            window.currentStoryCallback = callback;
        }

        // Close cutscene
        function closeCutscene() {
            document.getElementById('storyCutscene').style.display = 'none';
            if (window.currentStoryCallback) {
                window.currentStoryCallback();
                window.currentStoryCallback = null;
            }
        }

        // Show achievement
        function showAchievement(text) {
            const achievement = document.createElement('div');
            achievement.className = 'achievement';
            achievement.textContent = text;
            document.body.appendChild(achievement);
            
            setTimeout(() => {
                if (achievement.parentNode) {
                    achievement.remove();
                }
            }, 3000);
        }

        // Audio functions
        function toggleAudio() {
            // Implementation similar to before but simplified
            const audioBtn = document.getElementById('audioBtn');
            const audioIcon = document.getElementById('audioIcon');
            
            if (!gameState.audioEnabled) {
                try {
                    gameState.audioContext = new (window.AudioContext || window.webkitAudioContext)();
                    gameState.audioEnabled = true;
                    audioIcon.textContent = 'üîä';
                    showAchievement('üîä Audio Enabled!');
                } catch (error) {
                    audioIcon.textContent = 'üîá';
                    showAchievement('‚ùå Audio Not Available');
                }
            } else {
                if (gameState.audioContext) {
                    gameState.audioContext.close();
                    gameState.audioContext = null;
                }
                gameState.audioEnabled = false;
                audioIcon.textContent = 'üîá';
                showAchievement('üîá Audio Disabled');
            }
        }

        function playSuccessSound() {
            if (!gameState.audioEnabled || !gameState.audioContext) return;
            
            try {
                const osc = gameState.audioContext.createOscillator();
                const gain = gameState.audioContext.createGain();
                
                osc.frequency.setValueAtTime(523, gameState.audioContext.currentTime); // C note
                osc.frequency.exponentialRampToValueAtTime(659, gameState.audioContext.currentTime + 0.2); // E note
                
                gain.gain.setValueAtTime(0.1, gameState.audioContext.currentTime);
                gain.gain.exponentialRampToValueAtTime(0.01, gameState.audioContext.currentTime + 0.3);
                
                osc.connect(gain);
                gain.connect(gameState.audioContext.destination);
                osc.start();
                osc.stop(gameState.audioContext.currentTime + 0.3);
            } catch (error) {
                console.log('Audio error:', error);
            }
        }

        function playErrorSound() {
            if (!gameState.audioEnabled || !gameState.audioContext) return;
            
            try {
                const osc = gameState.audioContext.createOscillator();
                const gain = gameState.audioContext.createGain();
                
                osc.frequency.setValueAtTime(200, gameState.audioContext.currentTime);
                
                gain.gain.setValueAtTime(0.1, gameState.audioContext.currentTime);
                gain.gain.exponentialRampToValueAtTime(0.01, gameState.audioContext.currentTime + 0.2);
                
                osc.connect(gain);
                gain.connect(gameState.audioContext.destination);
                osc.start();
                osc.stop(gameState.audioContext.currentTime + 0.2);
            } catch (error) {
                console.log('Audio error:', error);
            }
        }

        // Initialize the game when page loads
        initGame();
    </script>
</body>
</html> 